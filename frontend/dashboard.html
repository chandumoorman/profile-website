<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/assets/style.css">
</head>
<body>

<div class="card">
  <h2>Dashboard</h2>

  <input id="phone" placeholder="Phone">
  <textarea id="bio" placeholder="Bio"></textarea>

  <button onclick="save()">Save Profile</button>
  <button onclick="logout()">Logout</button>

  <div id="msg"></div>

  <div class="link"><a href="/login">Back to login</a></div>
</div>

<script>
const token = localStorage.getItem("token");

if(!token){
  window.location.href="/login";
}

async function loadMe(){
  try{
    const res = await fetch("/api/me", {
      headers: { "Authorization": "Bearer " + token }
    });

    if(res.status === 401){
      localStorage.removeItem("token");
      window.location.href="/login";
      return;
    }

    const data = await res.json();
    phone.value = data.phone || "";
    bio.value = data.bio || "";
  } catch(e){
    msg.innerText = "Network error. Refresh page.";
  }
}

async function save(){
  msg.innerText="Saving...";
  try{
    const res = await fetch("/api/me",{
      method:"PUT",
      headers:{
        "Authorization": "Bearer " + token,
        "Content-Type": "application/json"
      },
      body: JSON.stringify({phone: phone.value, bio: bio.value})
    });

    const data = await res.json();
    msg.innerText = data.status || "Saved";
  } catch(e){
    msg.innerText="Network error";
  }
}

function logout(){
  localStorage.removeItem("token");
  window.location.href="/login";
}

loadMe();
</script>
</body>
</html>
