<script>
/* JWT expiry handling */
const token = localStorage.getItem("token");
if(token){
  try{
    const payload = JSON.parse(atob(token.split(".")[1]));
    if(payload.exp * 1000 < Date.now()){
      localStorage.removeItem("token");
    } else {
      window.location.href="/dashboard";
    }
  }catch(e){
    localStorage.removeItem("token");
  }
}

async function login(){
  localStorage.removeItem("token");

  const res = await fetch("/api/login",{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      username: username.value,
      password: password.value
    })
  });

  const data = await res.json();

  if(data.access_token){
    localStorage.setItem("token", data.access_token);
    window.location.href="/dashboard";
  } else {
    msg.innerText = data.detail || "Login failed";
  }
}
</script>
